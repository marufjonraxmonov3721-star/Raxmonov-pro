<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no text-white">
    <title>Raxmonov Save Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .active-tab { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
        .video-card { transition: all 0.3s ease; }
        .video-card:active { transform: scale(0.98); }
    </style>
</head>
<body class="p-4">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-xl font-bold text-blue-400">Raxmonov Save Pro</h1>
        <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center"><i class="fas fa-bolt"></i></div>
    </div>

    <div class="flex gap-2 mb-8">
        <input type="text" id="searchInput" placeholder="Musiqa nomi..." class="flex-1 p-4 rounded-2xl bg-black/40 border border-white/10 outline-none text-sm">
        <button onclick="searchApp()" class="bg-blue-600 px-6 rounded-2xl"><i class="fas fa-search"></i></button>
    </div>

    <div id="resultsBox" class="space-y-4 pb-20">
        <div class="text-center text-gray-500 mt-10">Qidiruv natijalari shu yerda chiqadi</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
            authDomain: "gen-lang-client-0228947349.firebaseapp.com",
            databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com",
            projectId: "gen-lang-client-0228947349",
            appId: "1:253793341504:web:709752258000dab44fcfa5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Qidiruv natijalarini real vaqtda tinglash
        if (tg.initDataUnsafe.user) {
            const userId = tg.initDataUnsafe.user.id;
            onValue(ref(db, `search_results/${userId}`), (snapshot) => {
                const data = snapshot.val();
                if (data && data.results) {
                    renderResults(data.results);
                }
            });
        }

        window.searchApp = () => {
            const query = document.getElementById('searchInput').value;
            if(!query) return;
            document.getElementById('resultsBox').innerHTML = '<div class="text-center">Qidirilmoqda...</div>';
            tg.sendData(JSON.stringify({action: "app_search", query: query}));
        };

        function renderResults(results) {
            const box = document.getElementById('resultsBox');
            box.innerHTML = '';
            results.forEach(item => {
                const div = document.createElement('div');
                div.className = "glass p-3 rounded-3xl video-card flex gap-3";
                div.innerHTML = `
                    <img src="${item.thumb}" class="w-24 h-16 rounded-xl object-cover">
                    <div class="flex-1 overflow-hidden">
                        <h3 class="text-xs font-bold truncate">${item.title}</h3>
                        <div class="flex gap-2 mt-2">
                            <button onclick="download('${item.id}', 'mp3')" class="bg-blue-600/20 text-blue-400 text-[10px] px-3 py-1 rounded-lg">MP3</button>
                            <button onclick="download('${item.id}', 'mp4')" class="bg-green-600/20 text-green-400 text-[10px] px-3 py-1 rounded-lg">MP4</button>
                        </div>
                    </div>
                `;
                box.appendChild(div);
            });
        }

        window.download = (id, type) => {
            tg.sendData(JSON.stringify({action: "download", type: type, url: `https://youtu.be/${id}`}));
            tg.close();
        };
    </script>
</body>
</html>
