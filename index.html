<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raxmonov Save Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #0b0f1a; color: white; font-family: sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .loader { border-top-color: #3b82f6; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .v-card { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-xl font-bold text-blue-500 italic">RAXMONOV SAVE</h1>
        <div class="bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full text-[10px] font-bold">PRO V2</div>
    </div>

    <div class="flex gap-2 mb-6 sticky top-0 bg-[#0b0f1a] py-2 z-50">
        <input type="text" id="searchInput" placeholder="Musiqa yoki video nomi..." 
               class="flex-1 p-4 rounded-2xl bg-gray-900 border border-gray-800 outline-none text-sm focus:border-blue-500 transition-all">
        <button onclick="searchMusic()" class="bg-blue-600 w-14 h-14 rounded-2xl flex items-center justify-center active:scale-95 shadow-lg shadow-blue-900/40">
            <i class="fas fa-search text-lg"></i>
        </button>
    </div>

    <div id="resultsContainer" class="space-y-4 pb-20">
        <div id="initialState" class="text-center text-gray-600 mt-20 italic">
            <i class="fas fa-play-circle text-5xl mb-4 block opacity-20"></i>
            Hamma narsa ilova ichida! Qidiruvni boshlang.
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        async function searchMusic() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            const container = document.getElementById('resultsContainer');
            container.innerHTML = '<div class="flex justify-center mt-20"><div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-700 h-12 w-12"></div></div>';

            try {
                // Barqarorroq API qidiruv tizimi
                const response = await fetch(`https://invidious.sethforprivacy.com/api/v1/search?q=${encodeURIComponent(query)}&type=video`);
                const results = await response.json();
                
                renderResults(results);
            } catch (error) {
                container.innerHTML = '<div class="text-center text-red-500 mt-10 p-4 glass rounded-2xl">Xatolik! Internetni tekshiring yoki qayta urinib ko\'ring.</div>';
            }
        }

        function renderResults(items) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';

            if (!items || items.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 mt-10">Hech narsa topilmadi.</div>';
                return;
            }

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = "glass p-3 rounded-3xl v-card flex gap-4 items-center";
                
                // YouTube ID sini olish
                const videoId = item.videoId;
                const thumb = `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
                const title = item.title;
                const url = `https://www.youtube.com/watch?v=${videoId}`;

                card.innerHTML = `
                    <div class="relative w-24 h-16 flex-shrink-0">
                        <img src="${thumb}" class="w-full h-full rounded-xl object-cover">
                        <span class="absolute bottom-1 right-1 bg-black/70 text-[8px] px-1 rounded">${item.lengthSeconds} s</span>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <h3 class="text-[11px] font-bold truncate mb-2">${title}</h3>
                        <div class="flex gap-2">
                            <button onclick="downloadMedia('${url}', 'mp3')" class="bg-blue-600/20 text-blue-400 text-[9px] font-bold px-3 py-2 rounded-xl flex-1 uppercase">MP3</button>
                            <button onclick="downloadMedia('${url}', 'mp4')" class="bg-green-600/20 text-green-400 text-[9px] font-bold px-3 py-2 rounded-xl flex-1 uppercase">MP4</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function downloadMedia(url, type) {
            tg.HapticFeedback.notificationOccurred('success');
            tg.sendData(JSON.stringify({
                action: "download",
                type: type,
                url: url
            }));
            tg.close();
        }
    </script>
</body>
</html>
