<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Quiz & Top Rating</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --text: #f8fafc; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 500px; background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .hidden { display: none; }
        .btn { background: var(--accent); border: none; padding: 12px 20px; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .option-btn { background: #334155; color: white; text-align: left; margin-bottom: 8px; transition: 0.2s; }
        .option-btn:hover { background: #475569; }
        .user-card { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #334155; }
        input { width: 90%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; outline: none; }
    </style>
</head>
<body>

<div class="container" id="setup-screen">
    <h2>Xush kelibsiz!</h2>
    <p>Ismingizni kiriting va bilimingizni sinab ko'ring:</p>
    <input type="text" id="username" placeholder="Ismingiz...">
    <button class="btn" onclick="startQuiz()">Boshlash</button>
</div>

<div class="container hidden" id="quiz-screen">
    <h3 id="question-text">Savol yuklanmoqda...</h3>
    <div id="options-container"></div>
</div>

<div class="container hidden" id="result-screen">
    <h2>Natija: <span id="final-score">0</span> ball</h2>
    <p>Sizning natijangiz reytingga qo'shildi!</p>
    <hr>
    <h3>üèÜ Global Reyting (TOP 10)</h3>
    <div id="leaderboard"></div>
    <button class="btn" onclick="location.reload()">Qayta urinish</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
        authDomain: "gen-lang-client-0228947349.firebaseapp.com",
        databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com",
        projectId: "gen-lang-client-0228947349",
        storageBucket: "gen-lang-client-0228947349.firebasestorage.app",
        messagingSenderId: "253793341504",
        appId: "1:253793341504:web:709752258000dab44fcfa5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const questions = [
        { q: "O'zbekiston poytaxti qaysi?", a: ["Toshkent", "Samarqand", "Buxoro"], c: 0 },
        { q: "Dunyodagi eng katta okean?", a: ["Atlantika", "Tinch", "Hind"], c: 1 },
        { q: "HTML nima?", a: ["Dasturlash tili", "Belgilash tili", "Ma'lumotlar bazasi"], c: 1 },
        { q: "Quyoshga eng yaqin sayyora?", a: ["Venera", "Mars", "Merkuriy"], c: 2 },
        { q: "JavaScript-da o'zgaruvchi qanday e'lon qilinadi?", a: ["var", "let", "Ikkala javob ham to'g'ri"], c: 2 },
        { q: "8 x 8 necha bo'ladi?", a: ["64", "56", "72"], c: 0 },
        { q: "Eng yengil element qaysi?", a: ["Kislorod", "Vodorod", "Geliy"], c: 1 },
        { q: "O'zbekiston mustaqilligi qachon?", a: ["1990", "1991", "1992"], c: 1 },
        { q: "IT so'zining kengaytmasi?", a: ["Information Tech", "Internal Tech", "Internet Team"], c: 0 },
        { q: "Dunyoning eng baland cho'qqisi?", a: ["Everest", "K2", "Monblan"], c: 0 }
    ];

    let currentIdx = 0;
    let score = 0;
    let playerName = "";

    window.startQuiz = () => {
        playerName = document.getElementById('username').value;
        if (!playerName) return alert("Ismingizni yozing!");
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        showQuestion();
    };

    function showQuestion() {
        const q = questions[currentIdx];
        document.getElementById('question-text').innerText = q.q;
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        q.a.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'btn option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(i);
            container.appendChild(btn);
        });
    }

    function checkAnswer(i) {
        if (i === questions[currentIdx].c) score += 10;
        currentIdx++;
        if (currentIdx < questions.length) {
            showQuestion();
        } else {
            finishQuiz();
        }
    }

    async function finishQuiz() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-score').innerText = score;

        // Firebase-ga saqlash (ID sifatida ism va vaqtdan foydalanamiz)
        const userId = playerName + "_" + Date.now();
        await set(ref(db, 'users/' + userId), {
            username: playerName,
            score: score
        });

        loadLeaderboard();
    }

    function loadLeaderboard() {
        const topRef = query(ref(db, 'users'), orderByChild('score'), limitToLast(10));
        onValue(topRef, (snap) => {
            const board = document.getElementById('leaderboard');
            board.innerHTML = '';
            let list = [];
            snap.forEach(s => list.push(s.val()));
            list.reverse().forEach((u, i) => {
                board.innerHTML += `<div class="user-card"><span>#${i+1} ${u.username}</span> <b>${u.score}</b></div>`;
            });
        });
    }
</script>
</body>
</html>
