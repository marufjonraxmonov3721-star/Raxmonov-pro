<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docx Table to Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

    <div class="max-w-3xl mx-auto bg-white p-8 rounded-3xl shadow-xl">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">Docx Jadvaldan Test</h1>
        
        <div class="mb-6">
            <input type="file" id="docxInput" accept=".docx" 
                   class="w-full p-3 border-2 border-dashed border-gray-300 rounded-xl">
        </div>

        <button onclick="convertDocxToQuiz()" id="btn" 
                class="w-full bg-green-600 text-white font-bold py-4 rounded-xl hover:bg-green-700 transition">
            FAYLNI O'QISH VA TEST QILISH
        </button>

        <div id="quizArea" class="mt-10 space-y-6 hidden italic">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
            authDomain: "gen-lang-client-0228947349.firebaseapp.com",
            projectId: "gen-lang-client-0228947349",
            storageBucket: "gen-lang-client-0228947349.firebasestorage.app",
            messagingSenderId: "253793341504",
            appId: "1:253793341504:web:709752258000dab44fcfa5"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.convertDocxToQuiz = async () => {
            const input = document.getElementById('docxInput');
            const area = document.getElementById('quizArea');
            if (!input.files[0]) return alert("Faylni tanlang!");

            try {
                const arrayBuffer = await input.files[0].arrayBuffer();
                
                // Docx ni HTML formatida o'qiymiz (jadvallarni saqlab qolish uchun)
                const result = await mammoth.convertToHtml({ arrayBuffer });
                const html = result.value;

                // Vaqtinchalik element yaratib jadvalni qidiramiz
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                const rows = tempDiv.querySelectorAll('tr');

                let tests = [];

                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 2) {
                        const question = cells[0].innerText || cells[0].innerHTML;
                        let options = [];
                        for (let i = 1; i < cells.length; i++) {
                            options.push(cells[i].innerText || cells[i].innerHTML);
                        }
                        tests.push({ q: question, o: options });
                    }
                });

                // Firebasega saqlash
                await addDoc(collection(db, "manual_tests"), {
                    name: input.files[0].name,
                    content: tests,
                    time: new Date()
                });

                // Ekranga chiqarish
                area.innerHTML = "<h2 class='text-xl font-bold'>Savollar:</h2>";
                tests.forEach((t, i) => {
                    area.innerHTML += `
                        <div class="p-5 bg-gray-50 border rounded-2xl shadow-sm">
                            <p class="font-bold text-lg">${i+1}. ${t.q}</p>
                            <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${t.o.map(opt => `<button class="p-3 bg-white border rounded-xl text-left hover:bg-blue-50">${opt}</button>`).join('')}
                            </div>
                        </div>`;
                });
                area.classList.remove('hidden');
                alert("Jadval tahlil qilindi va Firebasega saqlandi!");

            } catch (err) {
                alert("Xato: Faylni o'qib bo'lmadi.");
            }
        };
    </script>
</body>
</html>
